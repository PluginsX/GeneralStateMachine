<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通用状态机系统</title>
    <!-- 标准ICO格式作为回退 -->
    <link rel="icon" href="./assets/images/favicon.ico" sizes="any">
    <!-- SVG格式（现代浏览器支持） -->
    <link rel="icon" href="./assets/images/favicon.svg" type="image/svg+xml">
    <!-- Apple设备支持 -->
    <link rel="apple-touch-icon" href="./assets/images/apple-touch-icon.png">
    <!-- Safari pinned tab -->
    <link rel="mask-icon" href="./assets/images/safari.svg" color="#1454ec">
    <link rel="stylesheet" href="./assets/styles/global.css">
    <script src="../src/lib/d3.v7.min.js"></script>
</head>

<body>
    <!-- 欢迎页面 -->
    <div id="welcome-screen">
        <div class="welcome-container">
            <div class="welcome-title">通用状态机系统</div>
            
            <div class="welcome-actions">
                <button id="welcome-new-project" class="action-button primary">新建工程</button>
                <button id="welcome-open-project" class="action-button secondary">打开工程</button>
            </div>
            
            <div class="welcome-section">
                <h3>📂 演示项目工程</h3>
                <div class="file-list" id="project-files-list">
                    <!-- 演示项目文件列表将通过JavaScript动态添加 -->
                </div>
            </div>
            
            <div class="welcome-section">
                <h3>📄 演示导入文件</h3>
                <div class="file-list" id="import-files-list">
                    <!-- 演示导入文件列表将通过JavaScript动态添加 -->
                </div>
            </div>
            
            <div class="welcome-footer">
                <p>选择一个演示项目或导入文件开始使用</p>
            </div>
        </div>
    </div>

    <!-- 顶部菜单栏 -->
    <div class="menu-bar">
        <div class="menu-group">
            <!-- 文件菜单 -->
            <div class="export-submenu">
                <button id="file-menu">文件</button>
                <div class="export-submenu-content">
                    <button id="new-project">新建工程</button>
                    <button id="open-project">打开工程</button>
                    <button id="save-project">保存工程</button>
                </div>
            </div>
            <!-- 设置菜单 -->
            <div class="export-submenu">
                <button id="settings-menu">设置</button>
                <div class="export-submenu-content">
                    <button id="Hotkey-settings">热键设置</button>
                    <!-- <button id="Style-settings">配色设置</button>
                    <button id="Layout-settings">布局设置</button> -->
                </div>
            </div>
            <!-- 工具菜单 -->
            <div class="export-submenu">
                <button id="tools-menu">工具</button>
                <div class="export-submenu-content">
                    <!-- 导入子菜单 -->
                    <div class="export-submenu">
                        <button id="import-menu">导入</button>
                        <div class="export-submenu-content">
                            <button id="import-md">Markdown</button>
                            <button id="import-json">Json</button>
                            <button id="import-yaml">YAML</button>
                        </div>
                    </div>
                    
                    <!-- 导出子菜单 -->
                    <div class="export-submenu">
                        <button id="export-menu">导出</button>
                        <div class="export-submenu-content">
                            <button id="export-md">Markdown</button>
                            <button id="export-image">Image</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <select id="selection-filter" class="selection-filter">
                <option value="all">选择所有对象</option>
                <option value="nodes">仅选择节点</option>
                <option value="connections">仅选择连线</option>
            </select>
        </div>
        <div class="menu-group">
            <button id="undo">撤销</button>
            <button id="redo">重做</button>
            <button id="toggle-theme">切换主题</button>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="main-content">
        <!-- 左侧工具栏 -->
        <aside class="tool-panel">
            <!-- 工具栏（上方） -->
            <div class="toolbar-section">
                <h4 class="toolbar-title">工具</h4>
                <button id="merge-nodes-btn" class="toolbar-btn">合并节点</button>
                <button id="merge-conditions-btn" class="toolbar-btn">合并条件</button>
                <button id="remove-duplicate-connections-btn" class="toolbar-btn">删除重复连接</button>
                <button id="auto-arrange-btn" class="toolbar-btn">自动排列</button>
                <button id="real-time-arrange" class="toolbar-btn">实时自动排列</button>
                <button id="concentrate-arrange-btn" class="toolbar-btn">集中排列</button>
            </div>
            <!-- 纵向分隔线 -->
            <div class="toolbar-resizer" id="toolbar-resizer"></div>
            <!-- 对象栏（下方） -->
            <div class="object-section">
                <h4 class="toolbar-title">对象</h4>
                <div class="tool-item" draggable="true" data-type="node">
                    📦 节点
                </div>
                <div class="tool-item" draggable="true" data-type="connection">
                    🔗 连线
                </div>
            </div>
            <div class="tool-panel-resizer" id="tool-panel-resizer"></div>
        </aside>

        <!-- 中间工作区 -->
        <section class="workspace">
            <canvas id="editor-canvas"></canvas>
            <div class="selection-rectangle hidden"></div>
            <div class="workspace-resizer" id="workspace-resizer"></div>
        </section>

        <!-- 右侧属性栏 -->
        <aside class="property-panel">
            <div id="node-properties" class="property-section hidden">
                <h3>节点属性</h3>
                <div class="form-group">
                    <label for="node-name">节点名称</label>
                    <input type="text" id="node-name">
                </div>
                <div class="form-group">
                    <label for="node-description">节点描述</label>
                    <textarea id="node-description"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="node-color">节点颜色</label>
                    <input type="color" id="node-color" class="selector-color-picker" value="#ffffff">
                    <button id="node-color-reset" class="btn-small">重置为默认</button>
                </div>

                <div class="form-group">
                    <label>尺寸设置</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="node-autosize">
                        <label for="node-autosize">自适应内容尺寸</label>
                    </div>
                </div>

                <div class="form-group dimension-inputs">
                    <div>
                        <label for="node-width">宽度</label>
                        <input type="number" id="node-width" min="50" max="500" value="150">
                    </div>
                    <div>
                        <label for="node-height">高度</label>
                        <input type="number" id="node-height" min="30" max="300" value="50">
                    </div>
                </div>

                <button id="update-node" class="btn">更新节点</button>
                <button id="delete-node" class="btn btn-danger">删除节点</button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <h4>连线信息</h4>
                    <div class="connection-list-section">
                        <div class="connection-list-group">
                            <label>出发的连线</label>
                            <div id="outgoing-connections" class="connection-list"></div>
                        </div>
                        <div class="connection-list-group">
                            <label>到达的连线</label>
                            <div id="incoming-connections" class="connection-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="connection-properties" class="property-section hidden">
                <h3>连线属性</h3>
                
                <div class="form-group">
                    <label for="connection-color">连线颜色</label>
                    <input type="color" id="connection-color" value="#666666">
                    <button id="connection-color-reset" class="btn-small">重置为默认</button>
                </div>
                
                <div class="form-group">
                    <label for="connection-line-width">连线粗细</label>
                    <input type="number" id="connection-line-width" min="0.5" max="10" step="0.5" value="1.5">
                    <button id="connection-line-width-reset" class="btn-small">重置为默认</button>
                </div>
                
                <div class="form-group">
                    <label for="connection-line-type">连线类型</label>
                    <select id="connection-line-type">
                        <option value="solid">连续线</option>
                        <option value="dashed">间隔线</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="connection-arrow-size">箭头尺寸</label>
                    <input type="number" id="connection-arrow-size" min="5" max="30" step="1" value="15">
                    <button id="connection-arrow-size-reset" class="btn-small">重置为默认</button>
                </div>
                
                <div class="form-group">
                    <label for="connection-arrow-color">箭头颜色</label>
                    <input type="color" id="connection-arrow-color" value="#888888">
                    <button id="connection-arrow-color-reset" class="btn-small">重置为默认</button>
                </div>
                
                <h4 style="margin-top: 20px;">连线条件</h4>
                <div id="conditions-list">
                    <!-- 条件项将通过JavaScript动态添加 -->
                </div>
                <button id="add-condition" class="btn">添加条件</button>
                <button id="delete-connection" class="btn btn-danger">删除连线</button>
            </div>

            <div id="no-selection" class="property-section">
                <h3>提示</h3>
                <p>选择节点或连线以编辑其属性</p>
            </div>
        </aside>
    </div>

    <!-- 底部状态栏 -->
    <footer class="status-bar">
        <div class="status-info">就绪</div>
        <div class="status-stats">
            <span id="node-count">节点: 0</span>
            <span class="status-separator">|</span>
            <span id="connection-count">连接: 0</span>
            <span class="status-separator">|</span>
            <span id="selection-info">选中: 0</span>
        </div>
        <div class="zoom-controls">
            <button id="zoom-out">-</button>
            <span id="zoom-level">100%</span>
            <button id="zoom-in">+</button>
        </div>
    </footer>

    <!-- 隐藏的文件输入，用于导入Markdown -->
    <input type="file" id="file-input" accept=".md" style="display: none;">
    <!-- 隐藏的文件输入，用于导入JSON -->
    <input type="file" id="json-input" accept=".json" style="display: none;">
    <!-- 隐藏的文件输入，用于导入YAML -->
    <input type="file" id="yaml-input" accept=".yaml,.yml" style="display: none;">
    <!-- 隐藏的文件输入，用于打开工程文件 -->
    <input type="file" id="project-input" accept=".json" style="display: none;">

    <script type="module" src="../src/main.js"></script>
</body>

</html>